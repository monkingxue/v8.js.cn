<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Testing · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog>博客</a><li class=active><a href=/docs>文档</a></ul></nav></header><main id=main><h1>Testing</h1><p>V8 includes a test framework that allows you to test the engine. The framework lets you run both our own test suites that are included with the source code and others, such as <a href=https://github.com/tc39/test262>the Test262 test suite</a>.<h2 id=running-the-v8-tests>Running the V8 tests <a href=#running-the-v8-tests aria-hidden=true class=bookmark>#</a></h2><p>Before you run the tests, <a href=/docs/build-gn>build V8 with GN</a>.<p>You can append <code>.check</code> to any build target to have tests run for it, e.g.<pre class=language-bash><code class=language-bash><span class=highlight-line><span class="token function">make</span> ia32.release.check</span><br><span class=highlight-line><span class="token function">make</span> ia32.check</span><br><span class=highlight-line><span class="token function">make</span> release.check</span><br><span class=highlight-line><span class="token function">make</span> check <span class="token comment"># builds and tests everything (no dot before "check"!)</span></span></code></pre><p>Before submitting patches, you should always run the <code>quickcheck</code> target, which builds a fast debug build and runs only the most relevant tests:<pre class=language-bash><code class=language-bash><span class=highlight-line><span class="token function">make</span> quickcheck</span></code></pre><p>If you built V8 using GN, you can run tests like this:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --gn</span></code></pre><p>Or if you want have multiple GN configurations and don’t want to run the tests on the last compiled configuration:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --outdir<span class="token operator">=</span>out.gn/ia32.release</span></code></pre><p>You can also run tests manually:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --arch-and-mode<span class="token operator">=</span>ia32.release <span class="token punctuation">[</span>--outdir<span class="token operator">=</span>foo<span class="token punctuation">]</span></span></code></pre><p>Or you can run individual tests:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --arch<span class="token operator">=</span>ia32 cctest/test-heap/SymbolTable/* mjsunit/delete-in-eval</span></code></pre><p>Run the script with <code>--help</code> to find out about its other options, <code>--outdir</code> defaults to <code>out</code>. Also note that using the <code>cctest</code> binary to run multiple tests in one process is not supported.<h2 id=running-the-mozilla-and-test262-tests>Running the Mozilla and Test262 tests <a href=#running-the-mozilla-and-test262-tests aria-hidden=true class=bookmark>#</a></h2><p>The V8 test framework comes with support for running the Mozilla test suite as well as the Test262 test suite. To download the test suites and then run them for the first time, do the following:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --download-data mozilla</span><br><span class=highlight-line>tools/run-tests.py --download-data test262</span></code></pre><p>To run the tests subsequently, you may omit the flag that downloads the test suite:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py mozilla</span><br><span class=highlight-line>tools/run-tests.py test262</span></code></pre><p>Note that V8 fails a number of Mozilla tests because they require Firefox-specific extensions.<h2 id=running-the-webkit-tests>Running the WebKit tests <a href=#running-the-webkit-tests aria-hidden=true class=bookmark>#</a></h2><p>Sometimes all of the above tests pass but WebKit build bots fail. To make sure WebKit tests pass run:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run-tests.py --progress<span class="token operator">=</span>verbose --outdir<span class="token operator">=</span>out --arch<span class="token operator">=</span>ia32 --mode<span class="token operator">=</span>release webkit --timeout<span class="token operator">=</span>200</span></code></pre><p>Replace <code>--arch</code> and other parameters with values that match your build options.<h2 id=running-microbenchmarks>Running microbenchmarks <a href=#running-microbenchmarks aria-hidden=true class=bookmark>#</a></h2><p>Under <code>test/js-perf-test</code> we have microbenchmarks to track feature performance. There is a special runner for these: <code>tools/run_perf.py</code>. Run them like:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run_perf.py --arch x64 --binary-override-path out.gn/x64.release/d8 test/js-perf-test/JSTests.json</span></code></pre><p>If you don’t want to run all the <code>JSTests</code>, you can provide a <code>filter</code> argument:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/run_perf.py --arch x64 --binary-override-path out.gn/x64.release/d8 --filter JSTests/TypedArrays test/js-perf-test/JSTests.json</span></code></pre><h2 id=updating-the-bytecode-expectations>Updating the bytecode expectations <a href=#updating-the-bytecode-expectations aria-hidden=true class=bookmark>#</a></h2><p>Sometimes the bytecode expectations may change resulting in <code>cctest</code> failures. To update the golden files, build <code>test/cctest/generate-bytecode-expectations</code> by running:<pre class=language-bash><code class=language-bash><span class=highlight-line>ninja -C out.gn/x64.release generate-bytecode-expectations</span></code></pre><p>…and then updating the default set of inputs by passing the <code>--rebaseline</code> flag to the generated binary:<pre class=language-bash><code class=language-bash><span class=highlight-line>out.gn/x64.release/generate-bytecode-expectations --rebaseline</span></code></pre><p>The updated goldens are now available in <code>test/cctest/interpreter/bytecode_expectations/</code>.<h2 id=adding-a-new-bytecode-expectations-test>Adding a new bytecode expectations test <a href=#adding-a-new-bytecode-expectations-test aria-hidden=true class=bookmark>#</a></h2><ol><li><p>Add a new test case to <code>cctest/interpreter/test-bytecode-generator.cc</code> and specify a golden file with the same test name.<li><p>Build <code>generate-bytecode-expectations</code>:<pre class=language-bash><code class=language-bash><span class=highlight-line>ninja -C out.gn/x64.release generate-bytecode-expectations</span></code></pre><li><p>Run<pre><code>out.gn/x64.release/generate-bytecode-expectations --raw-js testcase.js --output=test/cctest/interpreter/bytecode-expectations/testname.golden
</code></pre><p>where <code>testcase.js</code> contains the JavaScript test case that was added to <code>test-bytecode-generator.cc</code> and <code>testname</code> is the name of the test defined in <code>test-bytecode-generator.cc</code>.</ol></main><footer id=footer><nav><a href=https://v8.dev/docs/test>原文</a> · <a href=/logo>商标</a> · <a href=/terms>条款</a> · <a href=https://policies.google.com/privacy>隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.dev/tree/master/./src/docs/test.md rel=nofollow>在 GitHub 编辑此页面</a></nav><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>