<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Cross-compiling for ARM · V8</title><meta content="width=device-width,initial-scale=1" name=viewport><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><script>document.documentElement.className+=' js'</script><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog>博客</a><li class=active><a href=/docs>文档</a></ul></nav></header><main id=main><h1>Cross-compiling for ARM</h1><p>First, make sure you can <a href=/docs/build-gn>build with GN</a>.<p>Then, add android to your <code>.gclient</code> configuration file.<pre class=language-python><code class=language-python><span class=highlight-line>target_os <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'android'</span><span class="token punctuation">]</span>  <span class="token comment"># Add this to get Android stuff checked out.</span></span></code></pre><p>The <code>target_os</code> field is a list, so if you're also building on unix it'll look like this:<pre class=language-python><code class=language-python><span class=highlight-line>target_os <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'android'</span><span class="token punctuation">,</span> <span class="token string">'unix'</span><span class="token punctuation">]</span>  <span class="token comment"># Multiple target OSes.</span></span></code></pre><p>Run <code>gclient sync</code>, and you’ll get a large checkout under <code>./third_party/android_tools</code>.<p>Enable developer mode on your phone or tablet, and turn on USB debugging, via instructions <a href=https://developer.android.com/studio/run/device.html>here</a>. Also, get the handy <a href=https://developer.android.com/studio/command-line/adb.html><code>adb</code></a> tool on your path. It’s in your checkout at <code>./third_party/android_tools/sdk/platform-tools</code>.<h2 id=using-gm>Using <code>gm</code> <a href=#using-gm aria-hidden=true class=bookmark>#</a></h2><p>Use <a href=/docs/build-gn#gm>the <code>tools/dev/gm.py</code> script</a> to automatically build V8 tests and run them on the device.<pre><code>```bash
alias gm=/path/to/v8/tools/dev/gm.py
gm android_arm.release.check
```
</code></pre><p>This command pushes the binaries and tests to the <code>/data/local/tmp/v8</code> directory on the device.<h2 id=manual-build>Manual build <a href=#manual-build aria-hidden=true class=bookmark>#</a></h2><p>Use <code>v8gen.py</code> to generate an ARM release or debug build:<pre class=language-bash><code class=language-bash><span class=highlight-line>tools/dev/v8gen.py arm.release</span></code></pre><p>Then run <code>gn args out.gn/arm.release</code> and make sure you have the following keys:<pre class=language-python><code class=language-python><span class=highlight-line>target_os <span class="token operator">=</span> <span class="token string">"android"</span>      <span class="token comment"># These lines need to be changed manually</span></span><br><span class=highlight-line>target_cpu <span class="token operator">=</span> <span class="token string">"arm"</span>         <span class="token comment"># as v8gen.py assumes a simulator build.</span></span><br><span class=highlight-line>v8_target_cpu <span class="token operator">=</span> <span class="token string">"arm"</span></span><br><span class=highlight-line>is_component_build <span class="token operator">=</span> false</span></code></pre><p>The keys should be the same for debug builds. If you are building for an arm64 device like the Pixel C, which supports 32bit and 64bit binaries, the keys should look like this:<pre class=language-python><code class=language-python><span class=highlight-line>target_os <span class="token operator">=</span> <span class="token string">"android"</span>      <span class="token comment"># These lines need to be changed manually</span></span><br><span class=highlight-line>target_cpu <span class="token operator">=</span> <span class="token string">"arm64"</span>       <span class="token comment"># as v8gen.py assumes a simulator build.</span></span><br><span class=highlight-line>v8_target_cpu <span class="token operator">=</span> <span class="token string">"arm64"</span></span><br><span class=highlight-line>is_component_build <span class="token operator">=</span> false</span></code></pre><p>Now build:<pre class=language-bash><code class=language-bash><span class=highlight-line>ninja -C out.gn/arm.release d8</span></code></pre><p>Use <code>adb</code> to copy the binary and snapshot files to the phone:<pre class=language-bash><code class=language-bash><span class=highlight-line>adb shell <span class="token string">'mkdir -p /data/local/tmp/v8/bin'</span></span><br><span class=highlight-line>adb push out.gn/arm.release/d8 /data/local/tmp/v8/bin</span><br><span class=highlight-line>adb push out.gn/arm.release/icudtl.dat /data/local/tmp/v8/bin</span><br><span class=highlight-line>adb push out.gn/arm.release/natives_blob.bin /data/local/tmp/v8/bin</span><br><span class=highlight-line>adb push out.gn/arm.release/snapshot_blob.bin /data/local/tmp/v8/bin</span></code></pre><pre class=language-bash><code class=language-bash><span class=highlight-line>rebuffat:~/src/v8$ adb shell</span><br><span class=highlight-line>bullhead:/ $ <span class="token function">cd</span> /data/local/tmp/v8/bin</span><br><span class=highlight-line>bullhead:/data/local/tmp/v8/bin $ <span class="token function">ls</span></span><br><span class=highlight-line>v8 natives_blob.bin snapshot_blob.bin</span><br><span class=highlight-line>bullhead:/data/local/tmp/v8/bin $ ./d8</span><br><span class=highlight-line>V8 version 5.8.0 <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span></span><br><span class=highlight-line>d8<span class="token operator">></span> <span class="token string">'w00t!'</span></span><br><span class=highlight-line><span class="token string">"w00t!"</span></span><br><span class=highlight-line>d8<span class="token operator">></span></span></code></pre><h2 id=using-sourcery-g%2B%2B-lite>Using Sourcery G++ Lite <a href=#using-sourcery-g%2B%2B-lite aria-hidden=true class=bookmark>#</a></h2><p>The Sourcery G++ Lite cross compiler suite is a free version of Sourcery G++ from <a href=http://www.codesourcery.com>CodeSourcery</a>. There is a page for the <a href=http://www.codesourcery.com/sgpp/lite/arm>GNU Toolchain for ARM Processors</a>. Determine the version you need for your host/target combination.<p>The following instructions uses <a href=http://www.codesourcery.com/sgpp/lite/arm/portal/release858>2009q1-203 for ARM GNU/Linux</a>, and if using a different version please change the URLs and <code>TOOL_PREFIX</code> below accordingly.<h3 id=installing-on-host-and-target>Installing on host and target <a href=#installing-on-host-and-target aria-hidden=true class=bookmark>#</a></h3><p>The simplest way of setting this up is to install the full Sourcery G++ Lite package on both the host and target at the same location. This will ensure that all the libraries required are available on both sides. If you want to use the default libraries on the host there is no need the install anything on the target.<p>The following script installs in <code>/opt/codesourcery</code>:<pre class=language-bash><code class=language-bash><span class=highlight-line><span class="token important shebang">#!/bin/sh</span></span><br><br><span class=highlight-line><span class="token function">sudo</span> <span class="token function">mkdir</span> /opt/codesourcery</span><br><span class=highlight-line><span class="token function">cd</span> /opt/codesourcery</span><br><span class=highlight-line><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token string">"<span class="token variable">$USERNAME</span>"</span> <span class="token keyword">.</span></span><br><span class=highlight-line><span class="token function">chmod</span> g+ws <span class="token keyword">.</span></span><br><span class=highlight-line><span class="token function">umask</span> 2</span><br><span class=highlight-line><span class="token function">wget</span> http://www.codesourcery.com/sgpp/lite/arm/portal/package4571/public/arm-none-linux-gnueabi/arm-2009q1-203-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2</span><br><span class=highlight-line><span class="token function">tar</span> -xvf arm-2009q1-203-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2</span></code></pre><h2 id=profile>Profile <a href=#profile aria-hidden=true class=bookmark>#</a></h2><ul><li><p>Compile a binary, push it to the device, keep a copy of it on the host<pre class=language-bash><code class=language-bash><span class=highlight-line>adb shell <span class="token function">cp</span> /data/local/tmp/v8/bin/d8 /data/local/tmp/v8/bin/d8-version.under.test</span><br><span class=highlight-line><span class="token function">cp</span> out.gn/arm.release/d8 ./d8-version.under.test</span></code></pre><li><p>get a profiling log and copy it to the host:<pre class=language-bash><code class=language-bash><span class=highlight-line>adb push benchmarks /data/local/tmp</span><br><span class=highlight-line>adb shell <span class="token function">cd</span> /data/local/tmp/benchmarks<span class="token punctuation">;</span> <span class="token punctuation">..</span>/v8/bin/d8-version.under.test run.js --prof</span><br><span class=highlight-line>adb shell /data/local/tmp/v8/bin/d8-version.under.test benchmark.js --prof</span><br><span class=highlight-line>adb pull /data/local/tmp/benchmarks/v8.log ./</span></code></pre><li><p>open <code>v8.log</code> in your favorite editor and edit the first line to match the full path of the <code>d8-version.under.test</code> binary on your workstation (instead of the <code>/data/local/tmp/v8/bin/</code> path it had on the device)<li><p>run the tick processor with the host’s <code>d8</code> and an appropriate <code>nm</code> binary:<pre class=language-bash><code class=language-bash><span class=highlight-line><span class="token function">cp</span> out/x64.release/d8 <span class="token keyword">.</span>  <span class="token comment"># only required once</span></span><br><span class=highlight-line><span class="token function">cp</span> out/x64.release/natives_blob.bin <span class="token keyword">.</span>  <span class="token comment"># only required once</span></span><br><span class=highlight-line><span class="token function">cp</span> out/x64.release/snapshot_blob.bin <span class="token keyword">.</span>  <span class="token comment"># only required once</span></span><br><span class=highlight-line>tools/linux-tick-processor --nm<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">pwd</span><span class="token variable">)</span></span>/third_party/android_ndk/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-nm</span></code></pre></ul></main><footer id=footer><nav><a href=https://v8.dev/docs/cross-compile-arm>原文</a> · <a href=/logo>商标</a> · <a href=/terms>条款</a> · <a href=https://policies.google.com/privacy>隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.dev/tree/master/./src/docs/cross-compile-arm.md rel=nofollow>在 GitHub 编辑此页面</a></nav><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>